{"paragraphs":[{"text":"import org.apache.spark.sql.{DataFrame, SparkSession}\nimport org.apache.log4j.Logger\nimport org.apache.log4j.Level\nimport java.io.File","user":"anonymous","dateUpdated":"2018-02-01T09:36:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.{DataFrame, SparkSession}\nimport org.apache.log4j.Logger\nimport org.apache.log4j.Level\nimport java.io.File\n"}]},"apps":[],"jobName":"paragraph_1517308801084_199440452","id":"20180125-142223_645739549","dateCreated":"2018-01-30T10:40:01+0000","dateStarted":"2018-02-01T09:36:52+0000","dateFinished":"2018-02-01T09:36:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1624"},{"text":"Logger.getLogger(\"org\").setLevel(Level.ERROR)\nLogger.getLogger(\"akka\").setLevel(Level.ERROR)\n\nval spark = SparkSession\n  .builder()\n  .appName(\"Spark SQL basic example\")\n  .config(\"spark.master\", \"local\")\n  .getOrCreate()\n\n\ndef getListOfFile(dir: String): List[String] = {\n  val d = new File(dir)\n  if (d.exists && d.isDirectory) {\n    var res = d.listFiles.filter(_.isFile).toList\n    res = res.filter(_.getName.endsWith(\".json\"))\n    res.map(_.toString)\n  } else {\n    List[String]()\n  }\n}\n\ndef getJson(x: String): Unit = {\n  spark.read.json(x)\n}\n\ndef HaversineDistance(lat1:Double, lon1:Double, lat2:Double, lon2:Double) : Double = {\n    val AVERAGE_RADIUS_OF_EARTH_KM = 6371\n    \n    val latDistance = Math.toRadians(lat1 - lat2)\n    val lonDistance = Math.toRadians(lon1 - lon2)\n    \n    val sinLat = Math.sin(latDistance / 2)\n    val sinLon = Math.sin(lonDistance / 2)\n    \n    val a = sinLat * sinLat +\n      (Math.cos(Math.toRadians(lat1))\n        * Math.cos(Math.toRadians(lat2))\n        * sinLon * sinLon)\n    \n    val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n    \n    return (AVERAGE_RADIUS_OF_EARTH_KM * c)\n    }\n\nval HaversineDistanceUdf = udf(HaversineDistance _)\n\n","user":"anonymous","dateUpdated":"2018-02-01T09:36:55+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@53974d3c\ngetListOfFile: (dir: String)List[String]\ngetJson: (x: String)Unit\nHaversineDistance: (lat1: Double, lon1: Double, lat2: Double, lon2: Double)Double\nHaversineDistanceUdf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function4>,DoubleType,Some(List(DoubleType, DoubleType, DoubleType, DoubleType)))\n"}]},"apps":[],"jobName":"paragraph_1517308801085_199055703","id":"20180125-142301_2036030206","dateCreated":"2018-01-30T10:40:01+0000","dateStarted":"2018-02-01T09:36:55+0000","dateFinished":"2018-02-01T09:36:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1625"},{"dateUpdated":"2018-01-30T10:40:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517308801085_199055703","id":"20180130-083324_1222353753","dateCreated":"2018-01-30T10:40:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1626"},{"text":"//reading json df\nval jsonPath: String = \"/home/pythonadmuser/Desktop/local_cadvisu/json/sncf-cad-transport-prod/06_transport_segments/*\"\nval csvPath: String = \"/home/pythonadmuser/Desktop/local_cadvisu/csv/\"\n","user":"anonymous","dateUpdated":"2018-02-01T09:39:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"jsonPath: String = /home/pythonadmuser/Desktop/local_cadvisu/json/sncf-cad-transport-prod/06_transport_segments/*\ncsvPath: String = /home/pythonadmuser/Desktop/local_cadvisu/csv/\n"}]},"apps":[],"jobName":"paragraph_1517308801085_199055703","id":"20180125-143046_1090039923","dateCreated":"2018-01-30T10:40:01+0000","dateStarted":"2018-02-01T09:39:49+0000","dateFinished":"2018-02-01T09:39:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1627"},{"text":"/*\nval jsonFile = getListOfFile(jsonPath)\n\njsonFile.foreach{\n    println\n}\n*/","user":"anonymous","dateUpdated":"2018-01-30T18:01:52+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1517308801085_199055703","id":"20180130-093512_1206220174","dateCreated":"2018-01-30T10:40:01+0000","dateStarted":"2018-01-30T18:01:52+0000","dateFinished":"2018-01-30T18:01:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1628"},{"text":"def exportToCsv(x: DataFrame, exportDirectory: String): Unit = {\n  x.repartition(1)\n    .write\n    .mode(\"append\")\n    .option(\"header\", \"true\")\n    .csv(exportDirectory)\n}\n\n\nval df = spark.read.json(jsonPath)\nprintln(df.count, df.columns.size)\n    \nval df1 = df.drop(\"score\")\nval df2 = df1.withColumn(\"beginLat_beginLong_endLat_endLon_distance_km\", HaversineDistanceUdf(df1(\"beginLat\"), df1(\"beginLong\"), df1(\"endLat\"), df1(\"endLong\")))\n\nexportToCsv(df2, csvPath+\"sncf-cad-transport-prod/06_transport_segments/\")\n\n\n/*\nfor(e <- jsonFile) {\n    val df = spark.read.json(e)\n    println(df.count, df.columns.size)\n    \n    val df1 = df.drop(\"score\")\n    val df2 = df1.withColumn(\"beginLat_beginLong_endLat_endLon_distance_km\", HaversineDistanceUdf(df1(\"beginLat\"), df1(\"beginLong\"), df1(\"endLat\"), df1(\"endLong\")))\n    \n    exportToCsv(df2, csvPath+\"sncf-cad-transport-prod/06_transport_segments/\")\n}\n*/","user":"anonymous","dateUpdated":"2018-02-01T09:40:17+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"exportToCsv: (x: org.apache.spark.sql.DataFrame, exportDirectory: String)Unit\ndf: org.apache.spark.sql.DataFrame = [beginLat: double, beginLong: double ... 16 more fields]\n(73670,18)\ndf1: org.apache.spark.sql.DataFrame = [beginLat: double, beginLong: double ... 15 more fields]\ndf2: org.apache.spark.sql.DataFrame = [beginLat: double, beginLong: double ... 16 more fields]\n"}]},"apps":[],"jobName":"paragraph_1517308801085_199055703","id":"20180130-095252_1448687703","dateCreated":"2018-01-30T10:40:01+0000","dateStarted":"2018-02-01T09:39:52+0000","dateFinished":"2018-02-01T09:39:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1629"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517335480850_-1990664356","id":"20180130-180440_920537023","dateCreated":"2018-01-30T18:04:40+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1630"},{"dateUpdated":"2018-01-30T10:40:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517308801086_200209950","id":"20180125-145722_300453410","dateCreated":"2018-01-30T10:40:01+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1631"}],"name":"JsonToCsvsncf-cad-transport-prod","id":"2D73QGM61","angularObjects":{"2D5R26EDC:shared_process":[],"2D49QQE1Z:shared_process":[],"2D4AXB7EJ:shared_process":[],"2D57383AK:shared_process":[],"2D5Q1RJ4S:shared_process":[],"2D58DZSCU:shared_process":[],"2D419R7MY:shared_process":[],"2D5FNWST2:shared_process":[],"2D5TJPR66:shared_process":[],"2D5FDCGT3:shared_process":[],"2D5VCE5FZ:shared_process":[],"2D39NPP6R:shared_process":[],"2D5H94SSD:shared_process":[],"2D6DB69DE:shared_process":[],"2D6GU6UMQ:shared_process":[],"2D61RHCTA:shared_process":[],"2D42RXKJA:shared_process":[],"2D3W4SNNJ:shared_process":[],"2D6GHKSWC:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}