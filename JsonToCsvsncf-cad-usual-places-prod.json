{"paragraphs":[{"text":"import org.apache.spark.sql.{DataFrame, SparkSession}\nimport org.apache.log4j.Logger\nimport org.apache.log4j.Level\nimport java.io.File","user":"anonymous","dateUpdated":"2018-02-01T09:40:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.{DataFrame, SparkSession}\nimport org.apache.log4j.Logger\nimport org.apache.log4j.Level\nimport java.io.File\n"}]},"apps":[],"jobName":"paragraph_1517310033616_637812300","id":"20180125-142223_645739549","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-02-01T09:40:28+0000","dateFinished":"2018-02-01T09:40:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3525"},{"text":"Logger.getLogger(\"org\").setLevel(Level.ERROR)\nLogger.getLogger(\"akka\").setLevel(Level.ERROR)\n\nval spark = SparkSession\n  .builder()\n  .appName(\"Spark SQL basic example\")\n  .config(\"spark.master\", \"local\")\n  .getOrCreate()\n\n\ndef getListOfFile(dir: String): List[String] = {\n  val d = new File(dir)\n  if (d.exists && d.isDirectory) {\n    var res = d.listFiles.filter(_.isFile).toList\n    res = res.filter(_.getName.endsWith(\".json\"))\n    res.map(_.toString)\n  } else {\n    List[String]()\n  }\n}\n\n\n\ndef getJson(x: String): Unit = {\n  spark.read.json(x)\n}\n\ndef HaversineDistance(lat1:Double, lon1:Double, lat2:Double, lon2:Double) : Double = {\n    val AVERAGE_RADIUS_OF_EARTH_KM = 6371\n    \n    val latDistance = Math.toRadians(lat1 - lat2)\n    val lonDistance = Math.toRadians(lon1 - lon2)\n    \n    val sinLat = Math.sin(latDistance / 2)\n    val sinLon = Math.sin(lonDistance / 2)\n    \n    val a = sinLat * sinLat +\n      (Math.cos(Math.toRadians(lat1))\n        * Math.cos(Math.toRadians(lat2))\n        * sinLon * sinLon)\n    \n    val c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n    \n    return (AVERAGE_RADIUS_OF_EARTH_KM * c)\n    }\n\nval HaversineDistanceUdf = udf(HaversineDistance _)\n\n","user":"anonymous","dateUpdated":"2018-02-01T09:40:40+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@53974d3c\ngetListOfFile: (dir: String)List[String]\ngetJson: (x: String)Unit\nHaversineDistance: (lat1: Double, lon1: Double, lat2: Double, lon2: Double)Double\nHaversineDistanceUdf: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function4>,DoubleType,Some(List(DoubleType, DoubleType, DoubleType, DoubleType)))\n"}]},"apps":[],"jobName":"paragraph_1517310033616_637812300","id":"20180125-142301_2036030206","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-02-01T09:40:40+0000","dateFinished":"2018-02-01T09:40:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3526"},{"dateUpdated":"2018-01-30T11:00:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517310033616_637812300","id":"20180130-083324_1222353753","dateCreated":"2018-01-30T11:00:33+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3527"},{"text":"//reading json df\nval csvPath06_interesting_activities: String = \"/home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/06_interesting_activities/\"\nval csvPath08_usual_activities: String = \"/home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/08_usual_activities/\"\nval csvPath08_usual_places: String = \"/home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/08_usual_places/\"\nval csvPath09_origin_destination: String = \"/home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/09_origin_destination/\"\n","user":"anonymous","dateUpdated":"2018-02-01T09:40:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"csvPath06_interesting_activities: String = /home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/06_interesting_activities/\ncsvPath08_usual_activities: String = /home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/08_usual_activities/\ncsvPath08_usual_places: String = /home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/08_usual_places/\ncsvPath09_origin_destination: String = /home/pythonadmuser/Desktop/local_cadvisu/csv/sncf-cad-usual-places-prod/09_origin_destination/\n"}]},"apps":[],"jobName":"paragraph_1517310033616_637812300","id":"20180125-143046_1090039923","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-02-01T09:40:53+0000","dateFinished":"2018-02-01T09:40:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3528"},{"text":"\ndef getListOfCompressedFile(dir:String) : List[String] = {\n    val d = new File(dir)\n    if (d.exists && d.isDirectory) {\n        var res:List[java.io.File] = d.listFiles.filter(_.isFile).toList\n        res = res.filter(_.getName.endsWith(\".json.gz\"))\n        res.map(_.toString)\n    } else List[String]()\n}\n\ndef getListOfSubDirectories(directoryName: String): Array[String] = {\n    (new File(directoryName))\n        .listFiles\n        .filter(_.isDirectory)\n        .map(_.getName)\n}\n\n\n/*\nval jsonFile06_interesting_activities = getListOfCompressedFile(jsonPath06_interesting_activities)\nval jsonFolder08_usual_activities = getListOfSubDirectories(jsonPath08_usual_activities).map(x => jsonPath08_usual_activities+x)\nval jsonFile08_usual_places = getListOfCompressedFile(jsonPath08_usual_places)\nval jsonFile09_origin_destination = getListOfCompressedFile(jsonPath09_origin_destination)\n*/\n","user":"anonymous","dateUpdated":"2018-02-01T09:41:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"getListOfCompressedFile: (dir: String)List[String]\ngetListOfSubDirectories: (directoryName: String)Array[String]\n"}]},"apps":[],"jobName":"paragraph_1517310033616_637812300","id":"20180130-093512_1206220174","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-02-01T09:41:22+0000","dateFinished":"2018-02-01T09:41:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3529"},{"text":"def exportToCsv(x: DataFrame, exportDirectory: String): Unit = {\n  x.repartition(1)\n    .write\n    .mode(\"append\")\n    .option(\"header\", \"true\")\n    .csv(exportDirectory)\n}\n\n//06_interesting_activities\nval df=spark.read.json(\"/home/pythonadmuser/Desktop/local_cadvisu/json/sncf-cad-usual-places-prod/06_interesting_activities/*\")\nval df2 = df.withColumn(\"beginLat_beginLong_endLat_endLon_distance_km\", HaversineDistanceUdf(df(\"latitude\"), df(\"longitude\"), df(\"latitudeFav\"), df(\"longitudeFav\")))\n\n//exportToCsv(df2, csvPath06_interesting_activities)","user":"anonymous","dateUpdated":"2018-02-01T09:42:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"},"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"exportToCsv: (x: org.apache.spark.sql.DataFrame, exportDirectory: String)Unit\ndf: org.apache.spark.sql.DataFrame = [end_sequence: string, idFav: string ... 11 more fields]\ndf2: org.apache.spark.sql.DataFrame = [end_sequence: string, idFav: string ... 12 more fields]\n"}]},"apps":[],"jobName":"paragraph_1517310033617_637427551","id":"20180130-095252_1448687703","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-02-01T09:42:15+0000","dateFinished":"2018-02-01T09:42:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3530"},{"text":"","user":"anonymous","dateUpdated":"2018-02-01T09:44:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res77: Long = 20104942\n"}]},"apps":[],"jobName":"paragraph_1517331397635_-1547349532","id":"20180130-165637_1490661652","dateCreated":"2018-01-30T16:56:37+0000","dateStarted":"2018-02-01T09:43:55+0000","dateFinished":"2018-02-01T09:44:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3531"},{"text":"//08_usual_activities\ndef exportToCsv(x: DataFrame, exportDirectory: String): Unit = {\n  x.repartition(1)\n    .write\n    .mode(\"append\")\n    .option(\"header\", \"true\")\n    .csv(exportDirectory)\n}\n\n\nval df=spark.read.json(\"/home/pythonadmuser/Desktop/local_cadvisu/json/sncf-cad-usual-places-prod/08_usual_activities/*\")\n//exportToCsv(df, csvPath08_usual_activities)\n\n\n","user":"anonymous","dateUpdated":"2018-02-01T09:45:06+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"exportToCsv: (x: org.apache.spark.sql.DataFrame, exportDirectory: String)Unit\ndf: org.apache.spark.sql.DataFrame = [end_sequence: string, idFav: string ... 11 more fields]\n"}]},"apps":[],"jobName":"paragraph_1517320584589_-1659356240","id":"20180130-135624_1914910554","dateCreated":"2018-01-30T13:56:24+0000","dateStarted":"2018-02-01T09:45:06+0000","dateFinished":"2018-02-01T09:45:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3532"},{"text":"//08_usual_places\ndef exportToCsv(x: DataFrame, exportDirectory: String): Unit = {\n  x.repartition(1)\n    .write\n    .mode(\"append\")\n    .option(\"header\", \"true\")\n    .csv(exportDirectory)\n}\n\n\nval df=spark.read.json(\"/home/pythonadmuser/local_cadvisu/json/sncf-cad-usual-places-prod/08_usual_places/*\")\nexportToCsv(df, csvPath08_usual_places)\n","user":"anonymous","dateUpdated":"2018-02-01T09:47:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","editorHide":false,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"exportToCsv: (x: org.apache.spark.sql.DataFrame, exportDirectory: String)Unit\ndf: org.apache.spark.sql.DataFrame = [end_sequence: string, id_fav: string ... 10 more fields]\n"}]},"apps":[],"jobName":"paragraph_1517313264456_-1592160629","id":"20180130-115424_1397533278","dateCreated":"2018-01-30T11:54:24+0000","dateStarted":"2018-01-30T17:50:28+0000","dateFinished":"2018-01-30T17:50:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3533"},{"text":"","user":"anonymous","dateUpdated":"2018-01-30T17:51:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res87: Long = 1610332\n"}]},"apps":[],"jobName":"paragraph_1517333425714_-1553331262","id":"20180130-173025_2109902823","dateCreated":"2018-01-30T17:30:25+0000","dateStarted":"2018-01-30T17:30:33+0000","dateFinished":"2018-01-30T17:30:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3534"},{"text":"//09_origin_destination\n/*\nvar cnt:Int = 1\nfor(e <- jsonFile09_origin_destination) {\n    val df = spark.read.json(e)\n    \n    val df2 = df.withColumn(\"latitude_longitude_destination_latitude_destination_longitude_distance_km\", HaversineDistanceUdf(df(\"latitude\"), df(\"longitude\"), df(\"destination_latitude\"), df(\"destination_longitude\")))\n    \n    println(cnt)\n    exportToCsv(df2, csvPath09_origin_destination)\n    cnt += 1\n}\n*/\nval df = spark.read.json(\"/home/pythonadmuser/local_cadvisu/json/sncf-cad-usual-places-prod/09_origin_destination/*\")\nval df2 = df.withColumn(\"latitude_longitude_destination_latitude_destination_longitude_distance_km\", HaversineDistanceUdf(df(\"latitude\"), df(\"longitude\"), df(\"destination_latitude\"), df(\"destination_longitude\")))\n\nexportToCsv(df2, csvPath09_origin_destination)","user":"anonymous","dateUpdated":"2018-01-31T10:08:34+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"df: org.apache.spark.sql.DataFrame = [delta_day: bigint, destination: bigint ... 19 more fields]\ndf2: org.apache.spark.sql.DataFrame = [delta_day: bigint, destination: bigint ... 20 more fields]\n"}]},"apps":[],"jobName":"paragraph_1517310033617_637427551","id":"20180126-125523_1271527735","dateCreated":"2018-01-30T11:00:33+0000","dateStarted":"2018-01-30T17:53:07+0000","dateFinished":"2018-01-30T17:56:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3535"},{"dateUpdated":"2018-01-30T11:00:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1517310033617_637427551","id":"20180125-145722_300453410","dateCreated":"2018-01-30T11:00:33+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3536"}],"name":"JsonToCsvsncf-cad-usual-places-prod","id":"2D5F3PDKC","angularObjects":{"2D5R26EDC:shared_process":[],"2D49QQE1Z:shared_process":[],"2D4AXB7EJ:shared_process":[],"2D57383AK:shared_process":[],"2D5Q1RJ4S:shared_process":[],"2D58DZSCU:shared_process":[],"2D419R7MY:shared_process":[],"2D5FNWST2:shared_process":[],"2D5TJPR66:shared_process":[],"2D5FDCGT3:shared_process":[],"2D5VCE5FZ:shared_process":[],"2D39NPP6R:shared_process":[],"2D5H94SSD:shared_process":[],"2D6DB69DE:shared_process":[],"2D6GU6UMQ:shared_process":[],"2D61RHCTA:shared_process":[],"2D42RXKJA:shared_process":[],"2D3W4SNNJ:shared_process":[],"2D6GHKSWC:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}